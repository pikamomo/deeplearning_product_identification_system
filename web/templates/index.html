<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Image Treasure Hunt</title>
    <style>
        :root {
            --primary-color: #e5e9ed;
            --success-color: #67C23A;
            --warning-color: #E6A23C;
            --danger-color: #F56C6C;
            --text-color: #303133;
            --border-color: #161617;
            --container-padding: 40px;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background: #f5f7fa;
        }

        body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            min-height: 100vh;
        }

        .company-logo {
            position: absolute;
            top: 10px; /* Distance from container top */
            right: 10px; /* Distance from container right */
            height: 50px;
            z-index: 100;
            padding: 8px;
            background: white;
            border-radius: 8px 8px 8px 8px;
            box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.08);
            /* Remove old positioning properties */
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 30px auto 0;
            background: white;
            padding: var(--container-padding);
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            min-height: calc(100vh - 100px);
            position: relative;
            background-image: url("../pictures/bg.png");
        }

        .title-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
        }

        .title-logo {
            height: 40px; /* Adjust height based on your image */
            margin-bottom: 5px;
            display: block;
        }

        .title-divider {
            height: 40px;
            width: 3px;
            background-color: var(--border-color);
        }

        h1 {
            font-size: 20px;
            margin: 0 0 0 0;
            padding-bottom: 0;
            border-bottom: 0 solid var(--primary-color);
            display: inline-block;
            width: 100%;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            width: 100%;
        }

        .upload_button {
            background-image: url('../pictures/upload-icon.png');
            background-size: 20px;
            background-repeat: no-repeat;
            background-position: 10px center;
            padding-left: 40px;
        }

        .denoising_button {
            background-image: url('../pictures/denoise-icon.png');
            background-size: 20px;
            background-repeat: no-repeat;
            background-position: 10px center;
            padding-left: 40px;
        }

        .classification_button {
            background-image: url('../pictures/classify-icon.png');
            background-size: 20px;
            background-repeat: no-repeat;
            background-position: 10px center;
            padding-left: 40px;
        }

        .similarity_button {
            background-image: url('../pictures/similarity-icon.png');
            background-size: 20px;
            background-repeat: no-repeat;
            background-position: 10px center;
            padding-left: 40px;
        }

        /* Ensure all button variants have background */
        .upload_button,
        .denoising_button,
        .classification_button,
        .similarity_button {
            /*background-image: linear-gradient(145deg, var(--primary-color), #a9b9cc);*/
            color: #574d4d;
        }

        button {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border: none; /* Remove border */
            /* Set background color */
            flex: 1; /* Make buttons evenly distributed */
            min-width: 120px; /* Set minimum width */
            text-align: center;
            background: linear-gradient(145deg, var(--primary-color), #314a67);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background: linear-gradient(145deg, #a9b9cc, var(--primary-color));
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .preview-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .preview-card:hover {
            transform: translateY(-5px);
        }

        .preview-image,
        .noised-image,
        .denoising-image {
            width: 100%;
            height: 192px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: white;
            object-fit: contain;
            margin-bottom: 0;
        }

        #image-upload {
            box-sizing: border-box;
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            margin-bottom: 25px;
            transition: border-color 0.3s;
        }


        #image-upload:hover {
            border-color: #ed8308;
        }

        #result-text {
            box-sizing: border-box;
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            min-height: 20px;
            background: #f8f9fa;
        }

        .similar-images {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            justify-content: space-between;
            gap: 15px;
            width: 100%;
        }

        .similar-images img {
            width: 100%;
            height: 160px;
            object-fit: contain;
            border-radius: 6px;
        }

    </style>
</head>
<body>

<div class="container">
    <div class="title-container">
        <h1>Intelligent Product Recognition System</h1>
    </div>

    <input type="file" id="image-upload" accept="image/*">

    <div class="button-group">
        <button id="upload_button" class="upload_button">Upload Image</button>
        <button id="denoising_button" class="denoising_button">Image Denoising</button>
        <button id="classification_button" class="classification_button">Product Classification</button>
        <button id="similarity_button" class="similarity_button">Similar Products</button>
    </div>

    <div class="preview-container">
        <div class="preview-card">
            <h3>Original Image</h3>
            <img class="preview-image" id="image-preview" src="" alt="Image Preview">
        </div>
        <div class="preview-card">
            <h3>Noisy Image</h3>
            <img class="noised-image" id="image-noised" src="" alt="Noisy Image">
        </div>
        <div class="preview-card">
            <h3>Denoised Result</h3>
            <img class="denoising-image" id="image-denoising" src="" alt="Denoised Image">
        </div>
    </div>

    <div>
        <h3>Classification Result</h3>
        <textarea id="result-text" rows="1" readonly></textarea>
    </div>

    <h3>Similar Product Recommendations</h3>
    <div class="similar-images" id="similar-images"></div>
</div>

<!-- Original script content remains unchanged -->

<script>
    const fileInput = document.getElementById('image-upload');
    const imagePreview = document.getElementById('image-preview');
    const imageNoised = document.getElementById('image-noised'); // Add noisy image reference
    const imageDenoising = document.getElementById('image-denoising'); // Add denoised image reference
    const similarImagesDiv = document.getElementById('similar-images');

    document.getElementById('upload_button').onclick = function () {

        if (fileInput.files.length === 0) {
            alert("Please select an image first!");
            return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
            imagePreview.src = e.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    document.getElementById('denoising_button').onclick = function () {
        console.log('=============> Denoising <=============');

        if (!imagePreview.src.startsWith("data:image")) {
            alert("Please select an image first!");
            return;
        }


        fetch(imagePreview.src)
            .then(response => response.blob())
            .then(blob => {
                const formData = new FormData();
                formData.append('image', blob);

                // Send request
                fetch('/denoising', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        // Update denoised image src
                        imageNoised.src = `data:image/png;base64,${data.noisy_img}`;
                        imageDenoising.src = `data:image/png;base64,${data.denoised_image}`;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
    };

    document.getElementById('classification_button').onclick = function () {
        console.log('=============> Classification <=============');

        if (!imageDenoising.src.startsWith("data:image")) {
            alert("Please denoise first!");
            return;
        }

        fetch(imageDenoising.src)
            .then(response => response.blob())
            .then(blob => {
                const formData = new FormData();
                formData.append('image', blob);
                fetch('/classification', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.text())
                    .then(text => {
                        document.getElementById('result-text').value = text;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
    };

    document.getElementById('similarity_button').onclick = function () {

        console.log('=============> Similarity Search <=============');


        if (!imageDenoising.src.startsWith("data:image")) {
            alert("Please denoise first!");
            return;
        }

        // Convert imageDenoising.src to Blob
        fetch(imageDenoising.src)
            .then(response => response.blob())
            .then(blob => {
                const formData = new FormData();
                formData.append('image', blob);

                // Send request to backend
                fetch('/simimages', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        // Clear previous similar images
                        similarImagesDiv.innerHTML = '';

                        // Display similar images
                        console.log(data.indices_list);
                        data.indices_list.forEach(index => {
                            const img = document.createElement('img');
                            img.src = `dataset/${index}.jpg`;  // Assuming output image naming rule is index.jpg
                            similarImagesDiv.appendChild(img);
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            })
            .catch(error => {
                console.error('Error:', error);
            });
    };
</script>
</body>
</html>